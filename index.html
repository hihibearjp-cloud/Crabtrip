<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>2026 é—œè¥¿èƒèŸ¹æ©«è‘—èµ°</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* å…¨å±€è¨­å®š & Reset */
        body { 
            margin: 0; padding: 0; 
            background-color: #FFF8F0; 
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", "Segoe UI", Roboto, sans-serif; 
            -webkit-tap-highlight-color: transparent; 
            padding-bottom: 100px; /* é¿é–‹åº•éƒ¨å°èˆª */
            padding-top: env(safe-area-inset-top);
        }
        * { box-sizing: border-box; user-select: none; }
        
        /* å‹•ç•«å®šç¾© */
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.7; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
        ::-webkit-scrollbar { display: none; }
        
        /* æŒ‰éˆ•é»æ“Šæ•ˆæœ */
        button:active { transform: scale(0.96); }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

// --- ğŸ¨ å·¥å…·ï¼šé¡åˆ¥é¡è‰² ---
const getTypeColor = (type) => {
    switch(type) {
        case 'ä½å®¿': return { bg: '#E0F2FE', text: '#0369A1' }; // è—
        case 'é£²é£Ÿ': return { bg: '#FEF3C7', text: '#B45309' }; // é»ƒ
        case 'å¨›æ¨‚': return { bg: '#FCE7F3', text: '#BE185D' }; // ç²‰
        case 'è³¼ç‰©': return { bg: '#DCFCE7', text: '#15803D' }; // ç¶ 
        case 'äº¤é€š': return { bg: '#F3F4F6', text: '#4B5563' }; // ç°
        default: return { bg: '#F3F4F6', text: '#666' };
    }
};

// --- âœ¨ çµ„ä»¶ï¼šæ™ºæ…§åŒ¯å…¥è¦–çª— ---
const SmartImporter = ({ onClose, onAdd }) => {
    const [mode, setMode] = useState('photo'); 
    const [status, setStatus] = useState('idle'); // idle, analyzing, review
    const [result, setResult] = useState(null);

    const startAnalysis = () => {
        setStatus('analyzing');
        // æ¨¡æ“¬ AI åˆ†æå»¶é²
        setTimeout(() => {
            setResult({
                title: mode === 'photo' ? "æ¸…æ°´å¯ºå¤œé–“åƒæ‹œ" : "ç¥æˆ¶ Mouriya ç‰›æ’",
                location: mode === 'photo' ? "äº¬éƒ½æ¸…æ°´å¯º" : "ç¥æˆ¶ä¸‰å®®",
                type: mode === 'photo' ? "å¨›æ¨‚" : "é£²é£Ÿ",
                cost: mode === 'photo' ? 400 : 12000,
                date: "2/4",
                note: "AI è‡ªå‹•æ“·å–ï¼šå»ºè­°æå‰é ç´„"
            });
            setStatus('review');
        }, 1500);
    };

    const s = {
        overlay: { position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.5)', zIndex: 2000, display: 'flex', alignItems: 'flex-end', backdropFilter: 'blur(3px)' },
        sheet: { background: 'white', width: '100%', borderRadius: '24px 24px 0 0', padding: '24px', animation: 'slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)', minHeight: '60vh', display: 'flex', flexDirection: 'column', paddingBottom: '40px' },
        tabs: { display: 'flex', background: '#F2F2F7', padding: '4px', borderRadius: '12px', marginBottom: '20px' },
        tab: (isActive) => ({ flex: 1, padding: '10px', textAlign: 'center', borderRadius: '10px', background: isActive ? 'white' : 'transparent', fontWeight: isActive ? 'bold' : 'normal', boxShadow: isActive ? '0 2px 4px rgba(0,0,0,0.1)' : 'none', transition: '0.2s', cursor:'pointer' }),
        uploadBox: { border: '2px dashed #FF9A9E', background: '#FFF0F0', borderRadius: '16px', height: '150px', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', color: '#FF6B6B', marginBottom: '20px', cursor:'pointer' },
        btn: { width: '100%', padding: '16px', borderRadius: '30px', background: '#333', color: '#F4B942', border: 'none', fontSize: '16px', fontWeight: 'bold', marginTop: 'auto', cursor:'pointer', boxShadow: '0 4px 12px rgba(0,0,0,0.2)' },
        input: { width: '100%', padding: '12px', borderRadius: '12px', background: '#F9F9F9', border: '1px solid #EEE', marginBottom: '12px', fontSize: '16px', outline: 'none' }
    };

    return (
        <div style={s.overlay} onClick={(e) => e.target === e.currentTarget && onClose()}>
            <div style={s.sheet}>
                <div style={{display:'flex', justifyContent:'space-between', marginBottom:'20px'}}>
                    <h2 style={{margin:0, fontSize:'20px'}}>âœ¨ æ™ºæ…§åŒ¯å…¥</h2>
                    <button onClick={onClose} style={{background:'none', border:'none', fontSize:'24px', color:'#999', cursor:'pointer'}}>Ã—</button>
                </div>

                {status === 'idle' && (
                    <>
                        <div style={s.tabs}>
                            <div style={s.tab(mode==='photo')} onClick={()=>setMode('photo')}>ğŸ“¸ æ‹ç…§ç‰‡</div>
                            <div style={s.tab(mode==='text')} onClick={()=>setMode('text')}>ğŸ“ è²¼æ–‡å­—</div>
                        </div>

                        {mode === 'photo' ? (
                            <div style={s.uploadBox} onClick={startAnalysis}>
                                <div style={{fontSize:'48px'}}>ğŸ“·</div>
                                <div style={{marginTop:'8px', fontWeight:'bold'}}>é»æ“Šä¸Šå‚³æˆªåœ– / ç…§ç‰‡</div>
                            </div>
                        ) : (
                            <textarea style={{...s.input, height:'120px', resize:'none'}} placeholder="è«‹è²¼ä¸Šè¡Œç¨‹æ–‡å­—..." />
                        )}

                        <button style={s.btn} onClick={startAnalysis}>é–‹å§‹ AI åˆ†æ</button>
                    </>
                )}

                {status === 'analyzing' && (
                    <div style={{flex:1, display:'flex', flexDirection:'column', alignItems:'center', justifyContent:'center'}}>
                        <div style={{fontSize:'60px', animation:'pulse 1s infinite'}}>ğŸ”®</div>
                        <h3 style={{marginTop:'20px', color:'#333'}}>æ­£åœ¨åˆ†æè¡Œç¨‹...</h3>
                        <p style={{color:'#888'}}>æ“·å–æ™‚é–“ã€åœ°é»èˆ‡é‡‘é¡ä¸­</p>
                    </div>
                )}

                {status === 'review' && result && (
                    <>
                        <div style={{marginBottom:'10px', color:'#888', fontSize:'14px'}}>è«‹ç¢ºèªè¾¨è­˜çµæœï¼š</div>
                        <div style={{flex:1, overflowY:'auto', paddingBottom:'20px'}}>
                            <input value={result.title} onChange={e=>setResult({...result, title:e.target.value})} style={s.input} placeholder="æ¨™é¡Œ" />
                            <div style={{display:'flex', gap:'10px'}}>
                                <input value={result.date} onChange={e=>setResult({...result, date:e.target.value})} style={{...s.input, flex:1}} placeholder="æ—¥æœŸ" />
                                <input value={result.cost} type="number" onChange={e=>setResult({...result, cost:Number(e.target.value)})} style={{...s.input, flex:1}} placeholder="é‡‘é¡" />
                            </div>
                            <input value={result.location} onChange={e=>setResult({...result, location:e.target.value})} style={s.input} placeholder="åœ°é»" />
                            <div style={{fontSize:'12px', background:'#FEF3C7', padding:'10px', borderRadius:'12px', color:'#D97706', lineHeight:'1.4'}}>
                                ğŸ’¡ {result.note}
                            </div>
                        </div>
                        <button style={s.btn} onClick={() => { onAdd(result); onClose(); }}>ç¢ºèªåŠ å…¥è¡Œç¨‹ âœ…</button>
                    </>
                )}
            </div>
        </div>
    );
};

// --- ğŸ  ä¸»æ‡‰ç”¨ç¨‹å¼ ---
const App = () => {
    const [showImport, setShowImport] = useState(false);
    
    // ğŸ’¾ åˆå§‹åŒ– Stateï¼šå„ªå…ˆå¾ LocalStorage è®€å–
    const [items, setItems] = useState(() => {
        const savedData = localStorage.getItem("kansai_2026_data");
        return savedData ? JSON.parse(savedData) : [
            { id: 1, date: "2/2", title: "å¤§é˜ª é›£æ³¢", location: "é›£æ³¢å…«é˜ªç¥ç¤¾", type: "ä½å®¿", cost: 15000, note: "èˆ¹ä¸Šä½å®¿" },
            { id: 2, date: "2/3", title: "æŠµé”é–€å¸æ¸¯", location: "é–€å¸æ¸¯", type: "ä½å®¿", cost: 12000, note: "ç¦å²¡ Quintessa" },
        ];
    });

    // ğŸ’¾ ç•¶ items è®Šå‹•æ™‚ï¼Œè‡ªå‹•å­˜å…¥ LocalStorage
    useEffect(() => {
        localStorage.setItem("kansai_2026_data", JSON.stringify(items));
    }, [items]);

    const budget = 200000;
    const totalSpent = items.reduce((sum, i) => sum + i.cost, 0);

    // ğŸ—‘ï¸ åˆªé™¤åŠŸèƒ½
    const handleDelete = (id) => {
        if(window.confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹è¡Œç¨‹å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸå–”ï¼")) {
            setItems(items.filter(item => item.id !== id));
        }
    };

    const s = {
        container: { maxWidth: '100%', minHeight: '100vh', background: '#FFF8F0' },
        header: {
            background: 'linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%)',
            padding: '20px 24px 30px', borderRadius: '0 0 32px 32px', color: 'white',
            boxShadow: '0 8px 20px rgba(255, 154, 158, 0.4)', position: 'sticky', top: 0, zIndex: 100
        },
        titleRow: { display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px' },
        crabIcon: { fontSize: '32px', filter: 'drop-shadow(0 2px 4px rgba(0,0,0,0.2))' },
        appTitle: { fontSize: '22px', fontWeight: '800', letterSpacing: '1px', lineHeight: '1.2', textShadow: '0 2px 4px rgba(0,0,0,0.1)' },
        moneyCard: {
            background: 'rgba(255, 255, 255, 0.25)', backdropFilter: 'blur(10px)',
            borderRadius: '20px', padding: '16px 24px', display: 'flex', justifyContent: 'space-between',
            alignItems: 'center', boxShadow: '0 4px 10px rgba(0,0,0,0.05)'
        },
        moneyLabel: { fontSize: '12px', opacity: 0.9, marginBottom: '4px' },
        moneyValue: { fontSize: '20px', fontWeight: 'bold' },
        
        sectionHeader: { padding: '24px 24px 12px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' },
        sectionTitle: { fontSize: '18px', fontWeight: 'bold', color: '#E86A6A', display:'flex', alignItems:'center', gap:'8px' },
        
        smartBtn: {
            background: '#333', color: '#F4B942', border: 'none', padding: '8px 16px',
            borderRadius: '20px', fontSize: '13px', fontWeight: 'bold',
            display: 'flex', alignItems: 'center', gap: '6px', boxShadow: '0 4px 10px rgba(0,0,0,0.1)',
            cursor: 'pointer', transition: 'transform 0.1s'
        },

        card: {
            background: 'white', margin: '0 20px 16px', padding: '16px', borderRadius: '20px',
            boxShadow: '0 4px 12px rgba(0,0,0,0.03)', display: 'flex', alignItems: 'center', gap: '16px',
            border: '2px solid white', position: 'relative', animation: 'fadeIn 0.5s ease'
        },
        deleteBtn: {
            position: 'absolute', top: '-8px', right: '-8px', width: '24px', height: '24px',
            background: '#FF6B6B', color: 'white', borderRadius: '50%', border: '2px solid white',
            display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer',
            fontSize: '14px', fontWeight: 'bold', boxShadow: '0 2px 6px rgba(0,0,0,0.1)'
        },
        dateCircle: {
            width: '52px', height: '52px', borderRadius: '50%', background: '#333', color: '#F4B942',
            display: 'flex', justifyContent: 'center', alignItems: 'center', fontWeight: 'bold', fontSize: '14px',
            border: '2px solid #F4B942', flexShrink: 0
        },
        content: { flex: 1, overflow: 'hidden' },
        itemTitle: { fontSize: '17px', fontWeight: 'bold', color: '#333', marginBottom: '6px', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' },
        itemSub: { fontSize: '13px', color: '#888', display:'flex', alignItems:'center', gap:'6px', flexWrap: 'wrap' },
        tag: (type) => {
            const colors = getTypeColor(type);
            return { 
                fontSize:'11px', padding:'3px 8px', borderRadius:'8px', 
                background: colors.bg, color: colors.text, fontWeight: 'bold' 
            };
        },
        cost: { color: '#FF6B6B', fontWeight: 'bold', fontSize: '16px' },

        nav: {
            position: 'fixed', bottom: 0, left: 0, right: 0, background: 'white',
            padding: '12px 0 24px', borderRadius: '24px 24px 0 0',
            display: 'flex', justifyContent: 'space-around',
            boxShadow: '0 -4px 20px rgba(0,0,0,0.05)', zIndex: 100
        },
        navItem: { display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px', fontSize: '11px', color: '#CCC', cursor: 'pointer' },
        navActive: { color: '#FF9A9E', fontWeight: 'bold' }
    };

    return (
        <div style={s.container}>
            {/* Header */}
            <div style={s.header}>
                <div style={s.titleRow}>
                    <div style={s.crabIcon}>ğŸ¦€</div>
                    <div style={s.appTitle}>
                        <div style={{fontSize:'14px', fontWeight:'normal', opacity:0.9}}>2026 é—œè¥¿</div>
                        <div>èƒèŸ¹æ©«è‘—èµ°</div>
                    </div>
                </div>
                <div style={s.moneyCard}>
                    <div><div style={s.moneyLabel}>å‰©é¤˜é ç®—</div><div style={s.moneyValue}>Â¥{(budget - totalSpent).toLocaleString()}</div></div>
                    <div style={{height:'30px', width:'1px', background:'rgba(255,255,255,0.4)'}}></div>
                    <div style={{textAlign:'right'}}><div style={s.moneyLabel}>ç¸½æ”¯å‡º</div><div style={s.moneyValue}>Â¥{totalSpent.toLocaleString()}</div></div>
                </div>
            </div>

            {/* Content */}
            <div style={s.sectionHeader}>
                <div style={s.sectionTitle}>ğŸ“… è¡Œç¨‹åˆ—è¡¨ ({items.length})</div>
                <button style={s.smartBtn} onClick={() => setShowImport(true)}>
                    <span>âœ¨</span> æ™ºæ…§åŒ¯å…¥
                </button>
            </div>

            <div style={{paddingBottom:'20px'}}>
                {items.length === 0 ? (
                    <div style={{textAlign:'center', padding:'40px', color:'#CCC'}}>
                        <div style={{fontSize:'40px', marginBottom:'10px'}}>ğŸƒ</div>
                        ç›®å‰æ²’æœ‰è¡Œç¨‹<br/>é»æ“Šå³ä¸Šè§’æ–°å¢
                    </div>
                ) : (
                    items.map(item => (
                        <div key={item.id} style={s.card}>
                            {/* åˆªé™¤æŒ‰éˆ• */}
                            <div style={s.deleteBtn} onClick={() => handleDelete(item.id)}>Ã—</div>
                            
                            <div style={s.dateCircle}>{item.date}</div>
                            <div style={s.content}>
                                <div style={s.itemTitle}>{item.title}</div>
                                <div style={s.itemSub}>
                                    <span style={s.tag(item.type)}>{item.type}</span>
                                    <span style={{display:'flex', alignItems:'center', gap:'4px'}}>
                                        ğŸ“ {item.location}
                                    </span>
                                </div>
                            </div>
                            <div style={s.cost}>Â¥{item.cost.toLocaleString()}</div>
                        </div>
                    ))
                )}
            </div>

            {/* Bottom Nav */}
            <div style={s.nav}>
                <div style={{...s.navItem, ...s.navActive}}>
                    <span style={{fontSize:'24px'}}>ğŸ—ºï¸</span> è¡Œç¨‹
                </div>
                <div style={s.navItem}>
                    <span style={{fontSize:'24px'}}>ğŸ’°</span> è¨˜å¸³
                </div>
                <div style={s.navItem}>
                    <span style={{fontSize:'24px'}}>ğŸ›ï¸</span> è³¼ç‰©
                </div>
            </div>

            {showImport && <SmartImporter onClose={()=>setShowImport(false)} onAdd={(i)=>setItems([...items, {...i, id:Date.now()}])} />}
        </div>
    );
};

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
